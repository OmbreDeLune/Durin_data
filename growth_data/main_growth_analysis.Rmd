---
title: "main_growth_analysis"
author: "OmbreDeLune"
date: "2024-06-06"
output: html_document
---
#Loading packages
```{r}
library(usethis)
library(tidyverse)
library(tibble)
library(dplyr)
library(lubridate)
library(zoo)
library(fixr)
```


#Obtaining a data frame to analyse Main_growth_data

```{r}
raw_data<-read.csv('half_cleaned_DURIN_data.csv')
```


For this dataframe, I need every data that refers to the main growth and total biomass.

First, I create a data frame with every columns except the remaining stuff: 
```{r}
raw_growth_data<-raw_data[,c(1:67,141:150)]
```


#Suppressing useless columns
For my analysis, I won't need these columns:
```{r}
useless_cols<-c("year","date","project","plant_height","photoID_N","photoID_W","general_comment","comment_reproductive_stem")
raw_growth_data<-raw_growth_data %>% select(-one_of(useless_cols))
```
For the first analyse, I won't need these columns neither: 
```{r}
useless_cols<-c("nbr_sidebranch_s1","nbr_sidebranch_s2","nbr_branches_lger_5mm","nbr_brk_branches_lger_5mm","nbr_brk_branches_shtr_5mm","length_longest_branch_cm","number_segments","presence_reproductive_str","presence_reproductive_stem")
raw_growth_data<-raw_growth_data%>% select(-one_of(useless_cols))
```

#reorder columns
Now I want to sort the data by stem, in this order: 
alive_leaf_count / alive_leaf_mass / dead_leaf_count / dead_leaf_mass /  fruits count / reproductive_mass / leaf_scars / branch_length / branch_mass



```{r}
col_order<-c("siteID","species","habitat","plotNR","DURIN_plot","comment_indiv","alive_leaf_count_s1_y1_b1","dead_leaf_count_s1_y1_b1","leaf_mass_s1_y1_b1","fruit_count_s1_y1_b1","reproductive_mass_s1_y1_b1","leaf_scar_s1_y1_b1","branch_length_s1_y1_b1","stem_mass_s1_y1_b1","alive_leaf_count_s2_y2_b1","leaf_mass_s2_y2_b1","dead_leaf_count_s2_y2_b1","dead_leaves_mass_s2_y2_b1","fruits_s2_y2_b1","reproductive_mass_s2_y2_b1","leaf_scar_s2_y2_b1","branch_length_s2_y2_b1","stem_mass_s2_y2_b1","alive_leaf_count_s2_y1_b1","alive_leaf_count_s2_y1_b2","alive_leaf_count_s2_y1_b3","alive_leaf_count_s2_y1_b4","leaf_mass_s2_y1_side_branches","fruits_s2_y1_b1","fruits_s2_y1_b2","fruits_s2_y1_b3","fruits_s2_y1_b4","fruit_mass_s2_y1_side_branches","leaf_scar_s2_y1_b1","leaf_scar_s2_y1_b2","leaf_scar_s2_y1_b3","leaf_scar_s2_y1_b4","branch_length_s2_y1_b1","branch_length_s2_y1_b2","branch_length_s2_y1_b3","branch_length_s2_y1_b4","stem_mass_s2_y1_side_branches","alive_leaf_count_s1_y1_b2","dead_leaf_count_s1_y1_b2","leaf_mass_s1_y1_b2","fruits_s1_y1_b2","leaf_scar_s1_y1_b2","branch_length_s1_y1_b2","stem_mass_s1_y1_b2")
col_names<-colnames(raw_growth_data)
other_col<-col_names[!(col_names %in% col_order)]
raw_growth_data<-select(raw_growth_data, c(col_order,other_col))
```


changing the species and sites for more clarity:
```{r}
raw_growth_data[raw_growth_data=="Vaccinium vitis-idaea"]<-'VV'
raw_growth_data[raw_growth_data=="Vaccinium myrtillus"]<-'VM'

raw_growth_data[raw_growth_data=="Sogndal"]<-'SO'
raw_growth_data[raw_growth_data=="Senje"]<-'SE'
raw_growth_data[raw_growth_data=="Lygra"]<-'LY'
raw_growth_data[raw_growth_data=="Kautokeino"]<-'KA'
```


#subseting the dataframe for biomass analysis
I just want to keep the mass columns. I don't want to keep the only S1 Y1 B2 stem as I will add it later on. I don't want dead biomass neither for now. 
```{r}
growth_wide<-raw_growth_data[,c("siteID","species","habitat","plotNR","DURIN_plot","comment_indiv","leaf_mass_s1_y1_b1","reproductive_mass_s1_y1_b1","stem_mass_s1_y1_b1","leaf_mass_s2_y2_b1","reproductive_mass_s2_y2_b1","stem_mass_s2_y2_b1","leaf_mass_s2_y1_side_branches","fruit_mass_s2_y1_side_branches","stem_mass_s2_y1_side_branches","total_main_repro_biomass","total_remain_repro_biomass","total_repro_biomass","total_main_vegetative_biomass","total_remain_vegetative_biomass","total_vegetative_biomass","total_alive_biomass","total_biomass")]
```
we ends with a wide dataset. 

#splitting data depending on the stem
I want to rearrange the data set in a data frame with different rows for different stems of the same sample.
```{r}
growth_halfwide <- data.frame(matrix(ncol = 10, nrow = 0))
colnames(growth_halfwide)<-c("siteID","species","habitat","plotNR","DURIN_plot","comment_indiv","stemID","alive_leaf_mass","reproductive_mass","stem_mass")
```
Now I complete the data frame with data. 
```{r}
for (i in c(1:nrow(growth_wide))){
  sampleID<-c(growth_wide[i,1:6])
  #S1 Y1 B1
  stemID<-c("S1_Y1_B1")
  stemdata<-c(growth_wide[i,c("leaf_mass_s1_y1_b1","reproductive_mass_s1_y1_b1","stem_mass_s1_y1_b1")])
  growth_halfwide[nrow(growth_halfwide)+1,]=c(sampleID,stemID,stemdata)
  
  #S2 Y2 B1
  stemID<-c("S2_Y2_B1")
  stemdata<-c(growth_wide[i,c("leaf_mass_s2_y2_b1","reproductive_mass_s2_y2_b1","stem_mass_s2_y2_b1")])
  growth_halfwide[nrow(growth_halfwide)+1,]=c(sampleID,stemID,stemdata)
  
  #S2 Y1 B
  stemID<-c("S2_Y1_B")
  stemdata<-c(growth_wide[i,c("leaf_mass_s2_y1_side_branches","fruit_mass_s2_y1_side_branches","stem_mass_s2_y1_side_branches")])
  growth_halfwide[nrow(growth_halfwide)+1,]=c(sampleID,stemID,stemdata)
  
}
```

manually adding the S1 Y1 B2 : 
```{r}
#S1Y1B2
s1y1b2row<-raw_growth_data[raw_growth_data$stem_mass_s1_y1_b2!=0,]
s1y1b2row <- s1y1b2row[!is.na(s1y1b2row$siteID), ]

sampleID<-c(s1y1b2row[1,1:6])
stemID<-c("S1_Y1_B2")
stemdata<-c(s1y1b2row[1,"leaf_mass_s1_y1_b2"],NA,s1y1b2row[1,"stem_mass_s1_y1_b2"])
growth_halfwide[nrow(growth_halfwide)+1,]=c(sampleID,stemID,stemdata)
```

In the lab, we have measured everything that should be measured in a plant, adding new columns as we processed samples with new structures. Then, the stems with "reproductive_mass"=NA had no reproductive structures. We can turn the NAs in 0 for the analysis.
```{r}
growth_halfwide$reproductive_mass<-growth_halfwide$reproductive_mass%>% replace(is.na(.), 0)
```



#Starting analysis

